<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Binary Division Solver by THE ASHIS DAS</title>
  <style>
    body { font-family: Arial; background: #f0f8ff; padding: 20px; color: #222; }
    h2, h3 { color: #003366; }
    input, select, button {
      padding: 8px; margin: 5px; font-size: 16px;
    }
    table {
      width: 100%; border-collapse: collapse; margin-top: 20px;
    }
    th, td {
      border: 1px solid #888; padding: 8px; text-align: center;
      background: #fff;
    }
    th { background: #d0e7ff; }
    #infoBox, #finalBox {
      margin-top: 20px; background: #e1f5fe; padding: 10px;
      border-left: 5px solid #0288d1; font-size: 16px;
    }
    #minBitsNotice {
      color: #d32f2f; font-weight: bold; padding-top: 10px;
    }
    #offlineMessage {
      color: red; font-size: 18px; font-weight: bold;
      background: #fff3f3; border: 2px solid #ff0000;
      padding: 20px; margin: 20px 0; display: none;
    }
  </style>
</head>
<body>

<div id="offlineMessage">❌ This tool only works online. Please check your internet connection.</div>

<div id="mainContent" style="display: none;">
  <h2>Binary Division Solver by THE ASHIS DAS</h2>

  <label>Dividend (Q): <input type="number" id="dividend" min="1" placeholder="Enter positive dividend" /></label>
  <label>Divisor (M): <input type="number" id="divisor" min="1" placeholder="Enter positive divisor" /></label>
  <label>Method:
    <select id="method">
      <option value="restoring">Restoring</option>
      <option value="nonrestoring">Non-Restoring</option>
    </select>
  </label>
  <label>Bit Size:
    <select id="bitSize"></select>
  </label>
  <button id="solveBtn" onclick="solve()" disabled>Solve</button>

  <div id="minBitsNotice"></div>
  <div id="infoBox"></div>
  <div id="resultTable"></div>
  <div id="finalBox"></div>
</div>

<script>
  // ONLINE CHECK
  function checkOnline() {
    if (!navigator.onLine) {
      document.getElementById("offlineMessage").style.display = "block";
      document.getElementById("mainContent").style.display = "none";
    } else {
      document.getElementById("offlineMessage").style.display = "none";
      document.getElementById("mainContent").style.display = "block";
    }
  }

  window.addEventListener('load', checkOnline);
  window.addEventListener('online', checkOnline);
  window.addEventListener('offline', checkOnline);
</script>

<!-- The rest of the script stays exactly the same -->
<script>
  function toTwosComplement(n, bits) {
    return n.toString(2).padStart(bits, '0');
  }

  function binaryAdd(a, b) {
    let carry = 0, res = '';
    for (let i = a.length - 1; i >= 0; i--) {
      let sum = parseInt(a[i]) + parseInt(b[i]) + carry;
      res = (sum % 2) + res;
      carry = Math.floor(sum / 2);
    }
    return res;
  }

  function twosComplement(bin) {
    let flipped = [...bin].map(b => b === '0' ? '1' : '0').join('');
    return binaryAdd(flipped, '1'.padStart(bin.length, '0'));
  }

  function leftShift(A, Q) {
    return {
      A: A.slice(1) + Q[0],
      Q: Q.slice(1) + '0'
    };
  }

  function calculateMinBits(dividend, divisor) {
    const maxVal = Math.max(dividend, divisor);
    let bits = 2;
    while (maxVal >= Math.pow(2, bits - 1)) bits++;
    return bits;
  }

  function updateBitSizeOptions(minBits) {
    const select = document.getElementById("bitSize");
    select.innerHTML = '';
    for (let i = 4; i <= 16; i++) {
      let option = document.createElement("option");
      option.value = i;
      option.text = `${i}-bit`;
      if (i < minBits) option.disabled = true;
      select.appendChild(option);
    }
    select.value = minBits <= 16 ? minBits : 16;
  }

  function solve() {
    const dividend = parseInt(document.getElementById("dividend").value);
    const divisor = parseInt(document.getElementById("divisor").value);
    const method = document.getElementById("method").value;
    const bits = parseInt(document.getElementById("bitSize").value);
    const minBitsNotice = document.getElementById("minBitsNotice");

    if (isNaN(dividend) || isNaN(divisor) || dividend <= 0 || divisor <= 0) {
      alert("Only positive integers are allowed for Dividend and Divisor.");
      return;
    }

    let minBits = calculateMinBits(dividend, divisor);

    if (minBits > 16) {
      minBitsNotice.textContent = `⚠️ Minimum bits needed: ${minBits}. This solver supports up to 16 bits only. Cannot solve.`;
      clearOutputs();
      return;
    } else {
      document.getElementById("solveBtn").disabled = false;
    }

    if (bits < minBits) {
      minBitsNotice.textContent = `⚠️ Selected bits too small. Minimum needed: ${minBits}`;
      clearOutputs();
      return;
    } else {
      minBitsNotice.textContent = '';
    }

    let A = '0'.repeat(bits);
    let Q = toTwosComplement(dividend, bits);
    let M = toTwosComplement(divisor, bits);
    let minusM = twosComplement(M);
    let rows = [];

    let info = `
      <b>Selected Bit Size:</b> ${bits}<br>
      <b>Q (Dividend):</b> ${Q} (${dividend})<br>
      <b>M (Divisor):</b> ${M} (${divisor})<br>
      <b>-M (2's Complement):</b> ${minusM}<br>
      <b>Initial A:</b> ${A}<br>
      <b>Total Steps:</b> ${bits}
    `;
    document.getElementById("infoBox").innerHTML = info;

    rows.push(`<table><tr><th>Step</th><th>A</th><th>Q</th><th>Operation</th><th>Reason</th></tr>`);

    for (let i = 0; i < bits; i++) {
      let step = i + 1;

      ({ A, Q } = leftShift(A, Q));
      rows.push(`<tr><td>${step}.1</td><td>${A}</td><td>${Q}</td><td>Left Shift A,Q</td><td>Shift A & Q Left</td></tr>`);

      if (method === 'restoring') {
        A = binaryAdd(A, minusM);
        rows.push(`<tr><td>${step}.2</td><td>${A}</td><td>${Q}</td><td>A - M</td><td>Subtract M</td></tr>`);

        if (A[0] === '1') {
          A = binaryAdd(A, M);
          Q = Q.slice(0, -1) + '0';
          rows.push(`<tr><td>${step}.3</td><td>${A}</td><td>${Q}</td><td>A + M</td><td>A < 0 ⇒ Restore A, Q₀ = 0</td></tr>`);
        } else {
          Q = Q.slice(0, -1) + '1';
          rows.push(`<tr><td>${step}.3</td><td>${A}</td><td>${Q}</td><td>Q₀ = 1</td><td>A ≥ 0 ⇒ Q₀ = 1</td></tr>`);
        }

      } else {
        if (A[0] === '0') {
          A = binaryAdd(A, minusM);
          rows.push(`<tr><td>${step}.2</td><td>${A}</td><td>${Q}</td><td>A - M</td><td>A ≥ 0 ⇒ Subtract M</td></tr>`);
        } else {
          A = binaryAdd(A, M);
          rows.push(`<tr><td>${step}.2</td><td>${A}</td><td>${Q}</td><td>A + M</td><td>A < 0 ⇒ Add M</td></tr>`);
        }

        if (A[0] === '0') {
          Q = Q.slice(0, -1) + '1';
          rows.push(`<tr><td>${step}.3</td><td>${A}</td><td>${Q}</td><td>Q₀ = 1</td><td>A ≥ 0 ⇒ Q₀ = 1</td></tr>`);
        } else {
          Q = Q.slice(0, -1) + '0';
          rows.push(`<tr><td>${step}.3</td><td>${A}</td><td>${Q}</td><td>Q₀ = 0</td><td>A < 0 ⇒ Q₀ = 0</td></tr>`);
        }
      }
    }

    if (method === 'nonrestoring' && A[0] === '1') {
      A = binaryAdd(A, M);
      rows.push(`<tr><td>Final</td><td>${A}</td><td>${Q}</td><td>A + M</td><td>Final restore because A < 0</td></tr>`);
    }

    rows.push(`</table>`);
    document.getElementById("resultTable").innerHTML = rows.join('');
    document.getElementById("finalBox").innerHTML = `
      <h3>✅ Final Result:</h3>
      <b>Quotient (Q):</b> ${Q} = ${parseInt(Q, 2)}<br>
      <b>Remainder (A):</b> ${A} = ${parseInt(A, 2)}
    `;
  }

  function clearOutputs() {
    document.getElementById("infoBox").innerHTML = '';
    document.getElementById("resultTable").innerHTML = '';
    document.getElementById("finalBox").innerHTML = '';
  }

  function onInputChange() {
    const dividendVal = document.getElementById("dividend").value;
    const divisorVal = document.getElementById("divisor").value;
    const solveBtn = document.getElementById("solveBtn");
    const minBitsNotice = document.getElementById("minBitsNotice");

    const dividend = parseInt(dividendVal);
    const divisor = parseInt(divisorVal);

    if (!dividendVal || !divisorVal || isNaN(dividend) || isNaN(divisor) || dividend <= 0 || divisor <= 0) {
      solveBtn.disabled = true;
      minBitsNotice.textContent = '';
      document.getElementById("bitSize").innerHTML = '';
      clearOutputs();
      return;
    }

    const minBits = calculateMinBits(dividend, divisor);
    updateBitSizeOptions(minBits);

    solveBtn.disabled = false;
    minBitsNotice.textContent = '';
    clearOutputs();
  }

  document.getElementById("dividend").addEventListener('input', onInputChange);
  document.getElementById("divisor").addEventListener('input', onInputChange);
  document.getElementById("bitSize").addEventListener('change', () => {
    document.getElementById("minBitsNotice").textContent = '';
    clearOutputs();
  });

  window.onload = () => {
    onInputChange();
  };
</script>

</body>
</html>